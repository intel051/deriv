<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒŒìƒìƒí’ˆ ë²•ê·œ ê²€ìƒ‰ ë° ìš”ì•½</title>
    
    <!-- Pretendard í°íŠ¸ ë¡œë“œ: ê°€ì¥ ì•ˆì •ì ì¸ CDN ë§í¬ ë°©ì‹ìœ¼ë¡œ êµì²´ -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Pretendard í°íŠ¸ ì „ì²´ ì ìš© ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì„¤ì • */
        body {
            font-family: 'Pretendard', sans-serif; /* í°íŠ¸ ì ìš© */
            background-color: #f7f9fb;
            color: #1e293b;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6; /* ê°€ë…ì„±ì„ ìœ„í•´ line-height ì¶”ê°€ */
        }

        /* Tailwind ì»¤ìŠ¤í„°ë§ˆì´ì§• (ê¸°ì¡´ ìœ ì§€) */
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 1rem;
            width: 100%;
        }
        .loading-animation {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1a73e8;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Markdown ìŠ¤íƒ€ì¼ë§ */
        .markdown-output {
            line-height: 1.8;
        }
        .markdown-output h1, .markdown-output h2, .markdown-output h3 {
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .markdown-output p {
            margin-bottom: 1rem;
        }
        .markdown-output ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
        }
        .markdown-output blockquote {
            border-left: 4px solid #9ca3af;
            padding-left: 1rem;
            margin: 1rem 0;
            color: #4b5563;
            background-color: #f3f4f6;
            border-radius: 4px;
        }
        .file-citation {
            background-color: #e5e7eb;
            color: #374151;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            margin-right: 0.5rem;
        }
    </style>
</head>
<body class="selection:bg-blue-100">

    <div class="container flex-grow">
        <header class="py-6 border-b border-gray-200 mb-6">
            <h1 class="text-3xl font-black text-gray-800">íŒŒìƒìƒí’ˆ ë²•ê·œ í‚¤ì›Œë“œ ê²€ìƒ‰ê¸° ğŸ”</h1>
            <p class="mt-1 text-gray-500">ì—…ë¡œë“œëœ "íŒŒìƒìƒí’ˆì‹œì¥ ì—…ë¬´ê·œì •" ë° "ì‹œí–‰ì„¸ì¹™"ì—ì„œ í‚¤ì›Œë“œë¥¼ ê²€ìƒ‰í•˜ê³  ë‚´ìš©ì„ ì •ë¦¬í•´ ë“œë ¤ìš”.</p>
        </header>

        <main>
            <div class="search-section bg-white p-6 rounded-xl shadow-lg mb-8">
                <label for="keywordInput" class="block text-lg font-bold mb-2">ê²€ìƒ‰ í‚¤ì›Œë“œ ì…ë ¥:</label>
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <input type="text" id="keywordInput" placeholder="ì˜ˆ: ìµœì¢…ê±°ë˜ì¼, ê±°ë˜ì¦ê±°ê¸ˆ, ì˜µì…˜ê±°ë˜"
                           class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150"
                           aria-label="ê²€ìƒ‰ í‚¤ì›Œë“œ ì…ë ¥ í•„ë“œ">
                    <button id="searchButton"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-150 shadow-md flex items-center justify-center disabled:opacity-50"
                            aria-label="ê²€ìƒ‰ ì‹œì‘ ë²„íŠ¼">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        ê²€ìƒ‰ ì‹œì‘
                    </button>
                </div>
            </div>

            <!-- ê²€ìƒ‰ ê²°ê³¼ ìš”ì•½ ì„¹ì…˜ -->
            <div class="result-section">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">ê²€ìƒ‰ ê²°ê³¼ ìš”ì•½</h2>
                <div id="resultOutput" class="bg-white p-6 rounded-xl shadow-lg min-h-48">
                    <p class="text-gray-500">ê²€ìƒ‰í•  í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ê³  "ê²€ìƒ‰ ì‹œì‘" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
                </div>
            </div>
            
            <!-- LLM ê¸°ë°˜ Q&A ì„¹ì…˜ -->
            <div class="qna-section mt-10 p-6 rounded-xl shadow-lg bg-yellow-50 border border-yellow-200">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    ë²•ê·œ ì „ë¬¸ê°€ì—ê²Œ ì§ˆë¬¸í•˜ê¸° ğŸ’¬
                </h2>
                <label for="qnaInput" class="block text-md font-medium text-gray-700 mb-2">ê¶ê¸ˆí•œ ë‚´ìš©ì„ ì§ì ‘ ì§ˆë¬¸í•´ ë³´ì„¸ìš”.</label>
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3">
                    <input type="text" id="qnaInput" placeholder="ì˜ˆ: ê±°ë˜ì¦ê±°ê¸ˆì˜ ì‚°ì¶œ ë°©ë²•ê³¼ ëª©ì ì„ ë¹„êµ ì„¤ëª…í•´ ì¤˜"
                           class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150"
                           aria-label="ê¶ê¸ˆí•œ ë‚´ìš© ì…ë ¥ í•„ë“œ">
                    <button id="qnaButton"
                            class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-6 rounded-lg transition duration-150 shadow-md flex items-center justify-center disabled:opacity-50"
                            aria-label="ì§ˆë¬¸í•˜ê¸° ë²„íŠ¼">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9.228a4.242 4.242 0 015.996 0M12 16h.01M12 21a9 9 0 110-18 9 9 0 010 18z"></path></svg>
                        ì§ˆë¬¸í•˜ê¸°
                    </button>
                </div>
                <div id="qnaOutput" class="mt-4 p-4 bg-white rounded-lg shadow-inner min-h-12 text-gray-700">
                    <p class="text-gray-500 text-sm">ì§ˆë¬¸ì„ ì…ë ¥í•˜ë©´ Gemini ëª¨ë¸ì´ ë¬¸ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹µë³€ì„ ìƒì„±í•©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </main>
    </div>

    <footer class="py-4 mt-8 border-t border-gray-200">
        <div class="container text-center text-sm text-gray-500">
            <p>Powered by êµ­ë‚´íŒŒìƒíŒ€ with Gemini API</p>
        </div>
    </footer>

    <script type="module">
        // Gemini API í˜¸ì¶œì„ ìœ„í•œ ê¸°ë³¸ ì„¤ì • (ìµœì‹  ëª¨ë¸ë¡œ ì—…ë°ì´íŠ¸ë¨)
        const apiKey = "AIzaSyA80AalwoEXR7xvuMy0jgaOVgGvlhVle_w"; // 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;

        // DOM ìš”ì†Œ ì •ì˜
        const keywordInput = document.getElementById('keywordInput');
        const searchButton = document.getElementById('searchButton');
        const resultOutput = document.getElementById('resultOutput');
        const qnaInput = document.getElementById('qnaInput');
        const qnaButton = document.getElementById('qnaButton');
        const qnaOutput = document.getElementById('qnaOutput');

        // LLM ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì •ì˜ (ë¬¸ì„œ ê²€ìƒ‰ ë° ìš”ì•½)
        const SEARCH_SYSTEM_PROMPT = `ë‹¹ì‹ ì€ í•œêµ­ íŒŒìƒìƒí’ˆ ì‹œì¥ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì…ë ¥í•œ í‚¤ì›Œë“œë¥¼ ë°”íƒ•ìœ¼ë¡œ ì œê³µëœ ì²¨ë¶€ íŒŒì¼(íŒŒìƒìƒí’ˆì‹œì¥ ì—…ë¬´ê·œì •, íŒŒìƒìƒí’ˆì‹œì¥ ì—…ë¬´ê·œì • ì‹œí–‰ì„¸ì¹™)ì„ ê²€ìƒ‰í•˜ì—¬ ë‚´ìš©ì„ ì°¾ì•„ì£¼ì„¸ìš”.

1. ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹µë³€ì„ êµ¬ì„±í•  ë•ŒëŠ” ë°˜ë“œì‹œ ì²¨ë¶€ íŒŒì¼ì˜ ë‚´ìš©ì„ í™œìš©í•˜ì—¬ ì •í™•í•˜ê²Œ ë‹µë³€í•´ì•¼ í•©ë‹ˆë‹¤.
2. ë‹µë³€ì€ ë°˜ë“œì‹œ í•œêµ­ì–´ í† ìŠ¤ ë¬¸ì²´ë¡œ ì¹œì ˆí•˜ê²Œ ì‘ì„±í•´ ì£¼ì„¸ìš”.
3. ë‹µë³€ì€ ë‹¤ìŒì˜ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ êµ¬ì„±í•´ ì£¼ì„¸ìš”:
- ì²« ë²ˆì§¸ ì„¹ì…˜: í‚¤ì›Œë“œì— ëŒ€í•œ "ê°„ê²°í•œ ìš”ì•½" (1~2ì¤„).
- ë‘ ë²ˆì§¸ ì„¹ì…˜: "ì£¼ìš” ë‚´ìš©" ì œëª© í•˜ì—, ê´€ë ¨ ì¡°í•­ì´ë‚˜ ì •ì˜ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì¸ìš©í•˜ê±°ë‚˜ ìš”ì•½í•´ ì£¼ì„¸ìš”.
- ëª¨ë“  ë‹µë³€ì—ëŠ” ì°¸ì¡° íŒŒì¼ì˜ ì¶œì²˜(íŒŒì¼ëª…ê³¼ ê´€ë ¨ ë‚´ìš©)ë¥¼ ëª…í™•í•˜ê²Œ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.

ì˜ˆì‹œ ë‹µë³€ í˜•ì‹:
"í‚¤ì›Œë“œ"ì— ëŒ€í•œ ìš”ì•½ ë‚´ìš©ì´ì—ìš”. 
"íŒŒìƒìƒí’ˆì‹œì¥ ì—…ë¬´ê·œì •" ë° "ì‹œí–‰ì„¸ì¹™"ì— ë”°ë¥´ë©´, ì´ í‚¤ì›Œë“œëŠ”...

## ì£¼ìš” ë‚´ìš©

* **ê´€ë ¨ ì •ì˜ ë˜ëŠ” ì¡°í•­**: [ë‚´ìš© ì„¤ëª… ë° ê´€ë ¨ íŒŒì¼ ì¸ìš©]
* **ì„¸ë¶€ ì‚¬í•­**: [ë‚´ìš© ì„¤ëª… ë° ê´€ë ¨ íŒŒì¼ ì¸ìš©]
* **ì ìš© ì˜ˆì‹œ**: [ë‚´ìš© ì„¤ëª… ë° ê´€ë ¨ íŒŒì¼ ì¸ìš©]
`;
        
        // LLM ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì •ì˜ (Q&A)
        const QNA_SYSTEM_PROMPT = `ë‹¹ì‹ ì€ í•œêµ­ íŒŒìƒìƒí’ˆ ë²•ê·œì— ëŒ€í•œ ì§ˆì˜ì‘ë‹µ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ ë°”íƒ•ìœ¼ë¡œ ì œê³µëœ ì²¨ë¶€ íŒŒì¼(íŒŒìƒìƒí’ˆì‹œì¥ ì—…ë¬´ê·œì •, íŒŒìƒìƒí’ˆì‹œì¥ ì—…ë¬´ê·œì • ì‹œí–‰ì„¸ì¹™)ì„ ê²€ìƒ‰í•˜ì—¬ ì§ˆë¬¸ì— ê°€ì¥ ì •í™•í•˜ê²Œ ë‹µë³€í•´ì•¼ í•©ë‹ˆë‹¤. ë‹µë³€ì€ ë°˜ë“œì‹œ ì²¨ë¶€ íŒŒì¼ì˜ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”. ë‹µë³€ì€ í•œêµ­ì–´ í† ìŠ¤ ë¬¸ì²´ë¡œ ì¹œì ˆí•˜ê²Œ ì‘ì„±í•˜ê³ , ë‹µë³€ ë§ë¯¸ì— ê´€ë ¨ ì¡°í•­ì„ ì–¸ê¸‰í•´ ì£¼ì„¸ìš”.`;


        // Markdown í…ìŠ¤íŠ¸ë¥¼ HTMLë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜ (ê°„ë‹¨ êµ¬í˜„)
        function renderMarkdown(markdownText) {
            let html = markdownText
                .replace(/^### (.*$)/gim, '<h3 class="text-xl font-semibold mt-4 mb-2">$1</h3>')
                .replace(/^## (.*$)/gim, '<h2 class="text-2xl font-bold mt-6 mb-3 border-b pb-1">$1</h2>')
                .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
                .replace(/\n/g, '<br>')
                .replace(/<br>\* /g, '<br><li>')
                .replace(/<br><br><li>/g, '<ul><li>')
                .replace(/<\/li><br><li>/g, '</li><li>')
                .replace(/<\/li><br>$/g, '</li></ul>')
                .replace(/<ul><li>(.*?)<\/ul><li>/g, '<ul><li>$1</li></ul>');

            if (html.startsWith('<br>')) {
                html = html.substring(4);
            }
            return html;
        }

        // ì§€ì—° ì²˜ë¦¬ ë° ì¬ì‹œë„ë¥¼ ìœ„í•œ Exponential Backoff ë¡œì§
        async function fetchWithBackoff(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429 && i < maxRetries - 1) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        console.warn(`429 Too Many Requests. Retrying in ${Math.ceil(delay / 1000)}s...`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`API request failed with status ${response.status}: ${errorText}`);
                    }
                    return response;
                } catch (error) {
                    if (i === maxRetries - 1) {
                        throw error;
                    }
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    console.warn(`Fetch error: ${error.message}. Retrying in ${Math.ceil(delay / 1000)}s...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }
        
        /**
         * LLM API í˜¸ì¶œ ë° ì‘ë‹µ ì²˜ë¦¬ ê³µí†µ í•¨ìˆ˜
         * @param {string} prompt - ì‚¬ìš©ì ì§ˆì˜
         * @param {string} systemPrompt - LLM ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
         * @param {HTMLElement} outputElement - ê²°ê³¼ë¥¼ í‘œì‹œí•  DOM ìš”ì†Œ
         * @param {HTMLElement} buttonElement - ìƒíƒœë¥¼ ë³€ê²½í•  ë²„íŠ¼ ìš”ì†Œ
         * @param {string} loadingText - ë¡œë”© ì‹œ í‘œì‹œí•  í…ìŠ¤íŠ¸
         * @returns {Promise<Object>} LLM í…ìŠ¤íŠ¸ì™€ ì†ŒìŠ¤ ì •ë³´ë¥¼ í¬í•¨í•˜ëŠ” ê°ì²´
         */
        async function callGeminiApi(prompt, systemPrompt, outputElement, buttonElement, loadingText) {
            buttonElement.disabled = true;
            buttonElement.innerHTML = `<div class="loading-animation mr-2"></div> ${loadingText}`;
            outputElement.innerHTML = `
                <div class="flex items-center justify-center p-8">
                    <div class="loading-animation mr-3"></div>
                    <p class="text-gray-600">${loadingText} ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...</p>
                </div>
            `;

            const userQuery = `ì²¨ë¶€ëœ ë¬¸ì„œ("íŒŒìƒìƒí’ˆì‹œì¥ ì—…ë¬´ê·œì •.pdf", "íŒŒìƒìƒí’ˆì‹œì¥ ì—…ë¬´ê·œì • ì‹œí–‰ì„¸ì¹™.pdf")ë¥¼ ì°¸ê³ í•˜ì—¬ ë‹¤ìŒ ìš”ì²­ì„ ì²˜ë¦¬í•´ ì£¼ì„¸ìš”: ${prompt}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            const options = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
            };

            let llmText = "";
            let sources = [];
            
            try {
                const response = await fetchWithBackoff(apiUrl, options);
                const result = await response.json();

                const candidate = result.candidates?.[0];

                if (!candidate || !candidate.content?.parts?.[0]?.text) {
                    throw new Error("API ì‘ë‹µ êµ¬ì¡°ê°€ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ë‚´ìš©ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.");
                }

                llmText = candidate.content.parts[0].text;

                const groundingMetadata = candidate.groundingMetadata;
                if (groundingMetadata && groundingMetadata.groundingAttributions) {
                    sources = groundingMetadata.groundingAttributions
                        .map(attribution => ({
                            uri: attribution.web?.uri,
                            title: attribution.web?.title,
                            snippet: attribution.web?.snippet,
                            fileName: attribution.document?.title || (attribution.web?.title.includes('íŒŒìƒìƒí’ˆì‹œì¥ ì—…ë¬´ê·œì •') ? 'íŒŒìƒìƒí’ˆì‹œì¥ ì—…ë¬´ê·œì •.pdf' : 'íŒŒìƒìƒí’ˆì‹œì¥ ì—…ë¬´ê·œì • ì‹œí–‰ì„¸ì¹™.pdf'),
                        }))
                        .filter(source => source.fileName);
                }
                
                return { llmText, sources };

            } catch (error) {
                 outputElement.innerHTML = `
                    <p class="text-red-500 font-bold mb-2">ì˜¤ë¥˜ ë°œìƒ!</p>
                    <p class="text-gray-600">ì˜¤ë¥˜ ë©”ì‹œì§€: ${error.message}</p>
                    <p class="text-gray-600 mt-2">ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p>
                `;
                return { llmText: null, sources: null };
            } finally {
                // ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ ê³³ì—ì„œ ë²„íŠ¼ ìƒíƒœë¥¼ ë‹¤ì‹œ ì„¤ì •í•©ë‹ˆë‹¤.
            }
        }


        // 1. í‚¤ì›Œë“œ ê²€ìƒ‰ ê¸°ëŠ¥
        async function searchDocuments() {
            const keyword = keywordInput.value.trim();
            if (!keyword) {
                resultOutput.innerHTML = '<p class="text-red-500 font-bold">ê²€ìƒ‰ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!</p>';
                return;
            }

            // UI ìƒíƒœ ë³€ê²½
            searchButton.disabled = true;
            searchButton.innerHTML = `<div class="loading-animation mr-2"></div> ê²€ìƒ‰ ì¤‘...`;
            
            const result = await callGeminiApi(
                `"${keyword}"ì— ëŒ€í•´ ê²€ìƒ‰í•˜ê³ , ê·¸ ë‚´ìš©ì„ ìƒì„¸íˆ ì •ë¦¬í•´ì„œ ë³´ì—¬ì¤˜.`, 
                SEARCH_SYSTEM_PROMPT, 
                resultOutput, 
                searchButton, 
                `ì—…ë¡œë“œëœ íŒŒì¼ì—ì„œ "${keyword}"(ìœ¼)ë¡œ ë‚´ìš©ì„ ê²€ìƒ‰`
            );

            // UI ìƒíƒœ ì´ˆê¸°í™”
            searchButton.disabled = false;
            searchButton.innerHTML = `<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> ê²€ìƒ‰ ì‹œì‘`;
            
            if (!result.llmText) return;

            // ê²°ê³¼ í‘œì‹œ
            let outputHtml = `<div class="markdown-output">${renderMarkdown(result.llmText)}</div>`;
            
            if (result.sources && result.sources.length > 0) {
                outputHtml += `
                    <div class="mt-6 pt-4 border-t border-gray-200">
                        <h3 class="text-lg font-bold text-gray-700 mb-2">ì°¸ì¡°ëœ ë¬¸ì„œ ë‚´ìš©</h3>
                        <div class="flex flex-wrap">
                `;
                result.sources.forEach(source => {
                    outputHtml += `
                        <span class="file-citation shadow-sm">
                            <svg class="w-4 h-4 mr-1 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                            <span>${source.fileName}</span>
                        </span>
                    `;
                });
                outputHtml += `</div></div>`;
            } else {
                outputHtml += `
                    <div class="mt-4 text-sm text-gray-500">
                        <p>ê²€ìƒ‰ëœ ë‚´ìš©ì´ ì—†ê±°ë‚˜, ë‹µë³€ êµ¬ì„±ì— ì§ì ‘ì ìœ¼ë¡œ ì°¸ì¡°ëœ êµ¬ì²´ì ì¸ ë¬¸ì„œ ì¶œì²˜ê°€ ì—†ìŠµë‹ˆë‹¤. í‚¤ì›Œë“œë¥¼ ë³€ê²½í•˜ì—¬ ë‹¤ì‹œ ê²€ìƒ‰í•´ ë³´ì„¸ìš”.</p>
                    </div>
                `;
            }

            resultOutput.innerHTML = outputHtml;
        }
        
        // 2. Q&A ê¸°ëŠ¥
        async function submitQna() {
            const question = qnaInput.value.trim();
            if (!question) {
                qnaOutput.innerHTML = '<p class="text-red-500 font-bold">ì§ˆë¬¸ ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!</p>';
                return;
            }

            // LLM í˜¸ì¶œ (ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ë³€ê²½)
            const result = await callGeminiApi(
                question, 
                QNA_SYSTEM_PROMPT, 
                qnaOutput, 
                qnaButton, 
                `ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì„ ìƒì„±`
            );
            
            // UI ìƒíƒœ ì´ˆê¸°í™”
            qnaButton.disabled = false;
            qnaButton.innerHTML = `<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9.228a4.242 4.242 0 015.996 0M12 16h.01M12 21a9 9 0 110-18 9 9 0 010 18z"></path></svg> ì§ˆë¬¸í•˜ê¸°`;

            if (result.llmText) {
                let outputHtml = `<div class="markdown-output">${renderMarkdown(result.llmText)}</div>`;
                 
                if (result.sources && result.sources.length > 0) {
                    outputHtml += `<div class="mt-3 text-xs text-gray-500">ì°¸ì¡°: ${result.sources.map(s => s.fileName).join(', ')}</div>`;
                }
                
                qnaOutput.innerHTML = outputHtml;
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        searchButton.addEventListener('click', searchDocuments);
        keywordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchDocuments();
            }
        });
        
        qnaButton.addEventListener('click', submitQna);
        qnaInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                submitQna();
            }
        });
    </script>
</body>
</html>

